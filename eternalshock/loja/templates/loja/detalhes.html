{% extends 'global/base.html' %}
{% load static %}

{% block titulo %}{{ produto.nome }} - G-Shock{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'loja/css/style.css' %}">
{% endblock %}

{% block corpo %}

<div class="detalhes-container">
    <div class="detalhes-grid">
        <div class="detalhes-imagem">
            {% if produto.imagem %}
                <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}">
            {% else %}
                <img src="https://via.placeholder.com/500x500?text={{ produto.nome }}" alt="{{ produto.nome }}">
            {% endif %}
        </div>

        <div class="detalhes-info">
            <span class="detalhes-categoria">{{ produto.get_categoria_display }}</span>
            <h1>{{ produto.nome }}</h1>
            <div class="detalhes-preco">R$ {{ produto.preco }}</div>

            {% if produto.estoque > 0 %}
                <div class="detalhes-estoque disponivel">
                    ✓ Em estoque ({{ produto.estoque }} unidades disponíveis)
                </div>
            {% else %}
                <div class="detalhes-estoque indisponivel">
                    ✗ Fora de estoque
                </div>
            {% endif %}

            <div class="detalhes-descricao">
                {{ produto.descricao }}
            </div>

            {% if produto.estoque > 0 %}
                <form method="post" action="{% url 'adicionar_ao_carrinho' produto.id %}">
                    {% csrf_token %}
                    <div class="forma-compra">
                        <label for="quantidade">Quantidade:</label>
                        <input type="number" id="quantidade" name="quantidade" value="1" min="1" max="{{ produto.estoque }}">
                    </div>

                    <div class="detalhes-botoes">
                        <button type="submit" class="btn-comprar">
                            <i class="bi bi-bag-check"></i> Adicionar ao Carrinho
                        </button>
                        <a href="{% url 'carrinho' %}" class="btn-carrinho">
                            <i class="bi bi-cart"></i> Ir para Carrinho
                        </a>
                    </div>
                </form>
            {% else %}
                <div class="detalhes-botoes">
                    <a href="{% url 'loja' %}" class="btn-carrinho">
                        <i class="bi bi-arrow-left"></i> Voltar à Loja
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    {% if produtos_relacionados %}
        <hr style="margin: 60px 0; border: none; border-top: 2px solid #ddd;">
        
        <h2 style="font-size: 1.8rem; font-weight: 700; margin-bottom: 30px; color: #1a1a1a;">
            Produtos Relacionados
        </h2>

        <div class="produtos-grid">
            {% for item in produtos_relacionados %}
                <div class="produto-card">
                    <div class="produto-imagem">
                        {% if item.imagem %}
                            <img src="{{ item.imagem.url }}" alt="{{ item.nome }}">
                        {% else %}
                            <img src="https://via.placeholder.com/280x250?text={{ item.nome }}" alt="{{ item.nome }}">
                        {% endif %}
                    </div>
                    <div class="produto-info">
                        <span class="produto-categoria">{{ item.get_categoria_display }}</span>
                        <h3 class="produto-nome">{{ item.nome }}</h3>
                        <p class="produto-descricao">{{ item.descricao }}</p>
                        <div class="produto-footer">
                            <span class="produto-preco">R$ {{ item.preco }}</span>
                            {% if item.estoque > 0 %}
                                <a href="{% url 'detalhes_produto' item.id %}" class="btn-adicionar">Ver Detalhes</a>
                            {% else %}
                                <button class="btn-adicionar" disabled>Indisponível</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

{% endblock %}
